<div class="page">
  <h1>To-Do</h1>

  <!-- Add Task -->
  <form class="add" (ngSubmit)="add()">
    <input [(ngModel)]="newTitle" name="title" placeholder="What needs to be done?"
           autocomplete="off" required />
    <button type="submit">Add</button>
  </form>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="filters">
      <button [class.active]="view() === 'all'" (click)="setView('all')">All</button>
      <button [class.active]="view() === 'active'" (click)="setView('active')">Active</button>
      <button [class.active]="view() === 'completed'" (click)="setView('completed')">Completed</button>
    </div>
    <div class="counts">
      <span>{{ remaining() }} left</span>
      <button class="link" (click)="clearCompleted()" [disabled]="completedCount() === 0">
        Clear completed ({{ completedCount() }})
      </button>
    </div>
  </div>

  <!-- Task List -->
  <ul class="list" *ngIf="filtered().length; else empty">
    <li *ngFor="let t of filtered()" [class.done]="t.completed">
      <label>
        <input type="checkbox" [checked]="t.completed" (change)="toggle(t.id)" />
        <span *ngIf="!editingId || editingId !== t.id" (dblclick)="startEdit(t)">
          {{ t.title }}
        </span>
      </label>

      <div class="actions" *ngIf="editingId !== t.id">
        <button (click)="startEdit(t)">Edit</button>
        <button class="danger" (click)="remove(t.id)">Delete</button>
      </div>

      <form *ngIf="editingId === t.id" class="edit" (ngSubmit)="commitEdit()">
        <input [(ngModel)]="editTitle" name="editTitle" required autofocus />
        <button type="submit">Save</button>
        <button type="button" class="ghost" (click)="cancelEdit()">Cancel</button>
      </form>
    </li>
  </ul>

  <ng-template #empty>
    <p class="empty">No tasks yet. Add your first one!</p>
  </ng-template>
</div>